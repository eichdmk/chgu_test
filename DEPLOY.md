# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ Vercel

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vercel CLI
npm i -g vercel

# –í–æ–π–¥–∏—Ç–µ
vercel login

# –î–µ–ø–ª–æ–π –≤ production
vercel --prod
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** —Å–º. `VERCEL_DEPLOY.md`

## –ü—Ä–æ–±–ª–µ–º–∞: ERR_TIMED_OUT –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Å—Å–µ—Ç–æ–≤

–ï—Å–ª–∏ –Ω–∞ `*.vercel.app` –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –Ω–∞ `www.chgumk.ru` —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Vite

- [x] `vite.config.js` —Å–æ–¥–µ—Ä–∂–∏—Ç `base: '/'` –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π
- [x] `assetsDir: 'assets'` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [x] –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å —Ö–µ—à–∞–º–∏ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
npm run build
ls -la dist/
cat dist/index.html  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ –∞—Å—Å–µ—Ç–∞–º
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—É—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏: `/assets/index-xxx.js`
- –ù–ï –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏: `./assets/` –∏–ª–∏ `assets/`

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel ‚úÖ

- [x] –°–æ–∑–¥–∞–Ω `vercel.json` —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `/assets/`
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω rewrite –¥–ª—è SPA (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí index.html)
- [x] –£–∫–∞–∑–∞–Ω—ã `buildCommand` –∏ `outputDirectory`

**–í–∞–∂–Ω–æ:** `vercel.json` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç!

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:**

1. **–¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:**
```nginx
location /assets/ {
    proxy_read_timeout 300s;
    proxy_connect_timeout 300s;
    send_timeout 300s;
}
```

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ç–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏:**
```nginx
location ~* \.(js|css)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

3. **SPA routing:**
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∏ CDN

- [ ] DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (A/AAAA –∏–ª–∏ CNAME)
- [ ] –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CDN (Cloudflare), –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
  - –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
  - SSL/TLS —Ä–µ–∂–∏–º: Full –∏–ª–∏ Full (strict)
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –≤–∫–ª—é—á–µ–Ω–æ
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π TTL –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏: 1 –º–µ—Å—è—Ü

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω –¥–ª—è `www.chgumk.ru` –∏ `chgumk.ru`
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ SSL –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –∏—Å—Ç–µ–∫

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞)

–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –¥—Ä—É–≥–æ–≥–æ –¥–æ–º–µ–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ:
```nginx
add_header Access-Control-Allow-Origin "*";
```

### 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ –Ω–∞–ø—Ä—è–º—É—é
curl -I https://www.chgumk.ru/assets/index-xxx.js
curl -I https://www.chgumk.ru/assets/index-xxx.css

# –î–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å:
# HTTP/2 200
# Cache-Control: public, max-age=31536000, immutable
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –ï—Å–ª–∏ ERR_TIMED_OUT:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
tail -f /var/log/nginx/chgumk_error.log
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ls -la /var/www/chgumk/dist/assets/
curl http://localhost/assets/index-xxx.js
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
```bash
chmod -R 755 /var/www/chgumk/dist
chown -R www-data:www-data /var/www/chgumk/dist
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã
sudo ufw status
```

### –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã (404):

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –≤ `root` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ nginx
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `try_files` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

### –ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:

- –í–∫–ª—é—á–∏—Ç–µ gzip –≤ nginx
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CDN (Cloudflare)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å < 500KB –ø–æ—Å–ª–µ gzip)

## üìù –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Vercel (–ü–†–ò–û–†–ò–¢–ï–¢)

### –®–∞–≥ 1: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
```bash
vercel --prod
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞ –≤ Vercel Dashboard
- Settings ‚Üí Domains ‚Üí –≤–∞—à –¥–æ–º–µ–Ω
- DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (CNAME –Ω–∞ `cname.vercel-dns.com`)
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞–∫—Ç–∏–≤–µ–Ω (—Å—Ç–∞—Ç—É—Å: "Valid Configuration")

### –®–∞–≥ 3: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare
- DNS –∑–∞–ø–∏—Å–∏: CNAME ‚Üí `cname.vercel-dns.com`
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ: –í–ö–õ–Æ–ß–ï–ù–û (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
- SSL/TLS —Ä–µ–∂–∏–º: **Full** –∏–ª–∏ **Full (strict)** (–ù–ï Flexible!)

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
```bash
curl -I https://www.chgumk.ru/assets/index-xxx.js
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `HTTP/2 200` —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

## üìù –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è Nginx

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `nginx.conf.example` –≤ `/etc/nginx/sites-available/chgumk`
2. –û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç–∏ –∫ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º (`root`)
4. –°–æ–∑–¥–∞–π—Ç–µ —Å–∏–º–ª–∏–Ω–∫:
```bash
sudo ln -s /etc/nginx/sites-available/chgumk /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–í–∫–ª—é—á–∏—Ç–µ Brotli —Å–∂–∞—Ç–∏–µ** (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è):
```nginx
brotli on;
brotli_comp_level 6;
brotli_types text/plain text/css application/json application/javascript text/xml application/xml;
```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP/2:**
```nginx
listen 443 ssl http2;
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞:**
```nginx
location ~* \.(js|css)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

